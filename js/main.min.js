function tagSearch(e){searchCode=uuid(),sendCommand("search_tag",null,{code:searchCode,q:e},function(e){if(console.log(e),searchCode==e.code){$(".c-b-wrapper").text("");for(var t=0;t<e.results;t++){var s=e.tags[t];$(".c-b-wrapper").append('<div class="c-result" onclick="addTag(\''+s+'\')"><h1 class="c-r-title">'+s+'</h1><div class="type c">+</div></div>')}}})}function addTag(e){sendCommand("add_favorite",null,{type:e},function(e){console.log(e.favorites)})}function uuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,s="x"==e?t:3&t|8;return s.toString(16)})}function sendCommand(e,t,s,n){if(null==t){var o=document.cookie.split("; ");for(i=0;i<o.length;i++){var a=o[i];if(a.startsWith("PHPSESSID")){t=a.split("=")[1],SID=t;break}}}var c="";for(var l in s)s.hasOwnProperty(l)&&(c+=l+"="+s[l]+"&");c+="session="+t;var d=new XMLHttpRequest;d.onreadystatechange=function(){4==this.readyState&&200==this.status&&(response=JSON.parse(this.responseText),"success"==response.status&&n(response))},d.open("POST","/api/"+e,!0),d.setRequestHeader("Content-type","application/x-www-form-urlencoded"),d.send(c)}function getImageHtml(e,t,s,n,i,o){return i=i/n*o,"<img class="+t+' src="/images/'+e+"."+s+' style="height:'+i+'px;">'}function updateImagePreview(){sendCommand("get_post",null,{id:openPost},function(e){console.log(e),$.ajax({type:"GET",url:"/meme_preview.php?id="+openPost+"&SID="+SID,success:function(e){$(".meme-preview-box-hover").remove(),$("body").append(e),$("#imp-bg-fade").css("display","")}})})}function showImagePreview(e){var t=e.target.dataset.id;sendCommand("get_post",null,{id:t},function(e){console.log(e),$.ajax({type:"GET",url:"/meme_preview.php?id="+t+"&SID="+SID,success:function(e){openPost=t,$("body").append(e),$("#imp-bg-fade").css("display","")}})})}function hideImagePreview(){$(".meme-preview-box-hover").remove()}function updateVotes(e,t,s){console.log(s);var n=document.getElementById("votes_"+e);n.innerHTML=t,s==-1?(n.previousElementSibling.classList.remove("vote-selected"),n.nextElementSibling.classList.add("vote-selected")):1==s?(n.previousElementSibling.classList.add("vote-selected"),n.nextElementSibling.classList.remove("vote-selected")):(n.previousElementSibling.classList.remove("vote-selected"),n.nextElementSibling.classList.remove("vote-selected"))}function upvotePost(e){sendCommand("upvote_post",null,{id:e},function(t){updateVotes(e,t.votes,t.vote)})}function downvotePost(e){sendCommand("downvote_post",null,{id:e},function(t){updateVotes(e,t.votes,t.vote)})}function upvoteComment(e){sendCommand("upvote_comment",null,{id:e},function(t){updateVotes(e,t.votes,t.vote)})}function downvoteComment(e){sendCommand("downvote_comment",null,{id:e},function(t){updateVotes(e,t.votes,t.vote)})}function repost(e,t){sendCommand("repost",null,{id:e},function(e){t.children[t.childElementCount-1].innerHTML=e.reposts,0==e.reposted?t.children[0].classList.remove("vote-selected"):t.children[0].classList.add("vote-selected")})}function postComment(){var e=document.getElementById("comment_text").value;e.length>0&&sendCommand("post_comment",null,{text:e,post:openPost,parent:parent},function(e){updateImagePreview()})}function setParent(e){parent=e}function showMore(e,t){document.getElementById("hidden_"+e).style.display=null,t.style.display="none",t.nextElementSibling.style.display=null}function showLess(e,t){document.getElementById("hidden_"+e).style.display="none",t.style.display="none",t.previousElementSibling.style.display=null}function focusComment(){document.getElementById("comment_text").focus()}function reply(e,t){parent=e;var s=document.getElementById("reply_to");s.innerHTML="In reply to <b>@"+t+"</b>",s.style.display=null,document.getElementById("comment_text").style.marginTop="22px"}function uploadFile(e,t,s,n,i){if(null==t){var o=document.cookie.split("; ");for(r=0;r<o.length;r++){var a=o[r];if(a.startsWith("PHPSESSID")){t=a.split("=")[1],SID=t;break}}}var c=new FormData;c.append("file",e),c.append("type",s),c.append("parent",n),c.append("library",i),c.append("session",t);for(var l=null,d=null,p=document.getElementsByClassName("l-content"),r=0;r<p.length;r++)p[r].dataset.id==i&&(d=p[r]),"POSTS"==p[r].dataset.id&&"POSTS"!=i&&(l=p[r]);var m=(Math.random()+1).toString(36).substring(7);$(".upload-popup-hover").css("display",""),$("#uploads").append('<div class="upload-popup-item"><i class="material-icons l-icon upload">image</i><h1 class="upload-title">'+(e.name.length>15?e.name.substring(0,15)+"...":e.name)+'</h1><div id="progress-'+m+'" class="progress-circle p0"><div class="left-half-clipper"><div class="first50-bar"></div><div class="value-bar"></div></div></div></div>'),$.ajax({type:"POST",url:"/api/create_post",contentType:!1,cache:!1,processData:!1,data:c,xhr:function(){var e=null;return e=window.ActiveXObject?new window.ActiveXObject("Microsoft.XMLHTTP"):new window.XMLHttpRequest,e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=Math.round(e.loaded/e.total*100);console.log(t),document.getElementById("progress-"+m).className="progress-circle p"+t+(t>50?" over50":"")}}),e},success:function(e){document.cookie="PHPSESSID="+SID+"; path=/",e=JSON.parse(e),console.log(e),$(d).find(".empty-library-content").remove(),d.innerHTML+=getImageHtml(e.id,"l-img",s),null!=l&&($(l).find(".empty-library-content").remove(),l.innerHTML+=getImageHtml(e.id,"l-img",s))}})}function loadPage(e,t){var s=new XMLHttpRequest;s.onreadystatechange=function(){4==this.readyState&&200==this.status&&t(this.responseText)},s.open("GET",e,!0),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.send()}function followAction(e){(e.classList.contains("follow")||e.classList.contains("unfollow"))&&sendCommand(e.classList.contains("follow")?"follow":"unfollow",null,{handle:e.dataset.handle},function(t){t.following?(e.classList.remove("follow"),e.classList.add("unfollow")):(e.classList.remove("unfollow"),e.classList.add("follow")),e.innerHTML="<span>"+t.followers+"</span>"})}function openOptions(e){var t=$("#"+e).offset();$(".l-sett-opt").css({top:t.top+15+"px",opacity:"0",right:"50px",display:""}),$("#imp-bg-fade").css("display",""),setTimeout(function(){var t=document.getElementById(e).dataset.id;document.getElementsByClassName("l-sett-opt")[0].dataset.id=t;var s=["POSTS","REPOSTS","FAVORITES"];s.includes(t)?$(".editable_lib").css({display:"none"}):$(".editable_lib").css({display:""}),$(".l-sett-opt").css({opacity:"",right:""}),$("#imp-bg-fade").css("opacity","")},10)}function closeOptions(){$(".l-sett-opt").css({opacity:"0",right:"50px"}),$("#imp-bg-fade").css("display",""),setTimeout(function(){$(".l-sett-opt").css("display","none")},100)}function deleteLib(){var e=document.getElementsByClassName("l-sett-opt")[0].dataset.id;sendCommand("delete_library",null,{id:e},function(e){"success"==e.status&&location.reload()})}function confirmDeleteLib(){elmt=$("#imp-bg-fade, #imp-message"),elmt.css("display",""),$(".l-sett-opt").css({opacity:"0",right:"50px"}),setTimeout(function(){elmt.css("opacity","")},10)}function openLibSettings(){document.getElementById("libForm").reset();var e=document.getElementsByClassName("l-sett-opt")[0].dataset.id;sendCommand("get_library",null,{id:e},function(e){var t=e,s=t.visibility,n=t.name,i=t.private;closeOptions(),openAddLib(),$("#lib_visibility_"+s).prop("checked",!0),$("#lib_name").val(n),$("#lib_private").prop("checked",1==i),$("#lib_edit_title").html("EDIT LIBRARY"),$(".sendAddLib").html("Save"),editLib=!0})}function openSettings(){closeAccount(),$(".s-settings").css({display:"table"}),$("#imp-bg-fade").css("display",""),setTimeout(function(){$(".l-sett-opt").css({opacity:"",right:""}),$("#imp-bg-fade").css("opacity","")},10)}function fadeToDark(){$("#imp-bg-fade").css("display",""),setTimeout(function(){$(".l-sett-opt").css({opacity:"",right:""}),$("#imp-bg-fade").css("opacity","")},10)}function unfade(){$("#imp-bg-fade").css({opacity:"0"}),setTimeout(function(){$(".l-sett-opt").css({display:"none"})},10)}function closeSettings(){$(".s-settings").css({display:"none"}),$("#imp-bg-fade").css("display","none")}function openTagSearch(){$(".tagFinder").css({display:"block"}),$("#imp-bg-fade").css("display",""),setTimeout(function(){$(".l-sett-opt").css({opacity:"",right:""}),$("#imp-bg-fade").css("opacity","")},10)}function closeTagSearch(){$(".tagFinder").css({display:"none"}),$("#imp-bg-fade").css("display","none")}function openStats(){$(".stats").css({display:"block"}),$("#imp-bg-fade").css("display",""),setTimeout(function(){$(".l-sett-opt").css({opacity:"",right:""}),$("#imp-bg-fade").css("opacity","")},10)}function closeStats(){$(".stats").css({display:"none"}),$("#imp-bg-fade").css("display","none")}function openAddLib(){editLib=!1,document.getElementById("libForm").reset(),$(".addLib").css({display:"block"}),$("#imp-bg-fade").css("display",""),setTimeout(function(){$(".l-sett-opt").css({opacity:"",right:""}),$("#imp-bg-fade").css("opacity","")},10),$("#lib_edit_title").html("ADD LIBRARY"),$(".sendAddLib").html("Add")}function openEditLib(){$(".addLib").css({display:"block"}),$("#imp-bg-fade").css("display",""),setTimeout(function(){$(".l-sett-opt").css({opacity:"",right:""}),$("#imp-bg-fade").css("opacity","")},10)}function closeAddLib(){$(".addLib").css({display:"none"}),$("#imp-bg-fade").css("display","none")}function openAccount(){$(".s-dropdown").css({display:"block"}),$("#imp-bg-fade").css("display",""),setTimeout(function(){$(".l-sett-opt").css({opacity:"",right:""}),$("#imp-bg-fade").css("opacity","")},10),$(".peep").children().css("filter","blur(5px)"),$(".s-dropdown").css("filter","blur(0px)"),$(".peep").css("background","#222")}function closeAccount(){$(".s-dropdown").css({display:"none"}),$("#imp-bg-fade").css("display","none"),$(".peep").children().css("filter","blur(0px)"),$(".peep").css("background","#fff")}function openPost(){window.scrollTo(0,0),$(".m-post").css({display:"block"}),$("#imp-bg-fade").css("display",""),setTimeout(function(){$(".l-sett-opt").css({opacity:"",right:""}),$("#imp-bg-fade").css("opacity","")},10)}function closePost(){$(".m-post").css({display:"none"}),$("#imp-bg-fade").css("display","none")}function openBalance(){$(".balance-message").css({display:"block"}),$("#imp-bg-fade").css("display",""),setTimeout(function(){$(".l-sett-opt").css({opacity:"",right:""}),$("#imp-bg-fade").css("opacity","")},10),$(".peep").children().css("filter","blur(5px)"),$(".balance-message").css("filter","blur(0px)"),$(".peep").css("background","#222")}function closeBalance(){$(".balance-message").css({display:"none"}),$("#imp-bg-fade").css("display","none"),$(".peep").children().css("filter","blur(0px)"),$(".peep").css("background","#fff")}function expandSidenav(){$(".sidenav-home").css({width:"950px"}),$(".home-content").css({width:"auto","margin-left":"950px"}),$(".searchbar").css({display:"none",opacity:"0"}),$(".expand-sidenav").css({transform:"rotate(-30deg)"}),$(".exp-post-corridor").css({display:"inline-block"}),$(".tl-post-title").css({display:"inline-block"}),setTimeout(function(){$(".exp-post-corridor").css({display:"inline-block"}),setTimeout(function(){$(".exp-post-corridor").css({opacity:"1"})},10)},100),setTimeout(function(){$(".tl-post-title").css({display:"inline-block"}),setTimeout(function(){$(".tl-post-title").css({opacity:"1"})},10)},100)}function compactSidenav(){$(".sidenav-home").css({width:"300px"}),$(".home-content").css({width:"auto","margin-left":"300px"}),$(".searchbar").css({display:"block"}),$(".expand-sidenav").css({transform:"rotate(30deg)"}),$(".exp-post-corridor").css({display:"none"}),setTimeout(function(){$(".exp-post-corridor").css({display:"none",opacity:"0"}),$(".tl-post-title").css({display:"none"})},10),$(".tl-post-title").css({opacity:"0"}),setTimeout(function(){$(".searchbar").css({display:"block",opacity:"1"})},100)}function showSidenav(){$(".sidenav-home").css({display:"block"}),$("#imp-bg-fade").css("display",""),setTimeout(function(){$(".sidenav-home").css({left:"0px"}),$("#imp-bg-fade").css("opacity","")},400)}function hideSidenav(){var e=$(window).width();return e>=1200?void showSidenav():($(".sidenav-home").css({left:"-500px"}),$("#imp-bg-fade").css("display","none"),void setTimeout(function(){$(".sidenav-home").css({display:"none"}),$("#imp-bg-fade").css("opacity","0")},400))}function removeDragData(e){e.dataTransfer.items?e.dataTransfer.items.clear():e.dataTransfer.clearData()}function libDrop(e){e.preventDefault();for(var t=e.dataTransfer.files,s=0;s<t.length;s++){var n=t[s],i=n.name.split(".");uploadFile(n,null,i[i.length-1],-1,e.srcElement.dataset.id)}removeDragData(e),$(e.srcElement).removeClass("is-dragover")}function libDrag(e){e.preventDefault(),$(e.srcElement).addClass("is-dragover")}function libDragLeave(e){e.preventDefault(),$(e.srcElement).removeClass("is-dragover")}toggled=new Array,searchCode="";var editLib=!1,SID=null,openPost="",parent=null;$(document).ready(function(){var e=!1,t=!1;for(libs=$(".library"),i=0;i<libs.length;i++)libs[i].id=i.toString();libs.click(function(e){toggled[this.id]?(this.querySelector(".l-settings").style.transform="",this.nextElementSibling.style.height="0px"):(this.querySelector(".l-settings").style.transform="rotate(180deg)",content=this.nextElementSibling,content.style.height="",height=content.clientHeight,content.style.height="0px",setTimeout(function(){content.style.height=height.toString()+"px",content.style.margin="0px"},10)),toggled[this.id]=!toggled[this.id]}),$(".l-drop").click(function(e){openOptions(this.parentElement.id),e.stopPropagation()}),$(".h-more").click(function(e){openOptions(this.parentElement.id),e.stopPropagation()}),$("#imp-bg-fade").click(function(){$("#imp-message, #imp-bg-fade").css("opacity","0"),setTimeout(function(){$("#imp-message, #imp-bg-fade").css("display","none")},100),closeSettings(),closeTagSearch(),closeStats(),closeAddLib(),closeAccount(),closePost(),closeBalance(),closeOptions(),hideSidenav(),hideImagePreview()}),$(".openSidenav").click(function(){e?hideSidenav():showSidenav(),t=!t}),$(".expand-sidenav").click(function(){e?compactSidenav():expandSidenav(),e=!e}),$(".openSettings").click(function(){openSettings(),$("#imp-bg-fade").css("opacity","")}),$(".closeSettings").click(function(){closeSettings(),$("#imp-message, #imp-bg-fade").css("opacity","0")}),$(".openTagSearch").click(function(){openTagSearch(),tagSearch(""),$("#imp-bg-fade").css("opacity","")}),$(".closeTagSearch").click(function(){closeTagSearch(),$("#imp-message, #imp-bg-fade").css("opacity","0")}),$(".openStats").click(function(){openStats(),$("#imp-bg-fade").css("opacity","")}),$(".closeStats").click(function(){closeStats(),$("#imp-message, #imp-bg-fade").css("opacity","0")}),$(".openAddLib").click(function(){openAddLib(),$("#imp-bg-fade").css("opacity","")}),$(".closeAddLib").click(function(){closeAddLib(),$("#imp-message, #imp-bg-fade").css("opacity","0")}),$(".openAccount").click(function(){openAccount(),$("#imp-bg-fade").css("opacity","")}),$(".closeAccount").click(function(){closeAccount(),$("#imp-message, #imp-bg-fade").css("opacity","0")}),$(".openPost").click(function(){openPost(),$("#imp-bg-fade").css("opacity","")}),$(".closePost").click(function(){closePost(),$("#imp-message, #imp-bg-fade").css("opacity","0")}),$(".openBalance").click(function(){openBalance(),$("#imp-bg-fade").css("opacity","")}),$(".closeBalance").click(function(){closeBalance(),$("#imp-message, #imp-bg-fade").css("opacity","0")}),$(".openEcSearch").click(function(){openBalance(),$("#imp-bg-fade").css("opacity","")}),$(".closeEcSearch").click(function(){closeBalance(),$("#imp-message, #imp-bg-fade").css("opacity","0")}),$(".expand-rec-section").click(function(){expandRec()}),$(".s-tab").click(function(){this.classList.contains("s-selected")||($(".s-tab").toggleClass("s-selected"),$(".s-c-wrapper").toggleClass("s-slide"))}),$(".t-cross").click(function(){var e=this.parentElement;sendCommand("delete_favorite",null,{type:this.dataset.type},function(t){e.parentNode.removeChild(e)})}),$(".c-title-holder .searchbar input").keyup(function(){tagSearch(this.value)}),$(".sendAddLib").click(function(){var e=$("#libForm").serializeArray();console.log(e);for(var t=new Array,s=0;s<e.length;s++)dataP=e[s],t[dataP.name]=dataP.value;if(e=t,editLib){var n=document.getElementsByClassName("l-sett-opt")[0].dataset.id;e.id=n}sendCommand(editLib?"edit_library":"create_library",null,e,function(e){console.log(e),location.reload()})}),$("#libForm").submit(function(e){e.preventDefault(),$(".sendAddLib").click()})});