function tagSearch(e){searchCode=uuid(),sendCommand("search_tag",null,{code:searchCode,q:e},function(e){if(console.log(e),searchCode==e.code){$(".c-b-wrapper").text("");for(var s=0;s<e.results;s++){var t=e.tags[s];$(".c-b-wrapper").append('<div class="c-result" onclick="addTag(\''+t+'\')"><h1 class="c-r-title">'+t+'</h1><div class="type c">+</div></div>')}}})}function addTag(e){sendCommand("add_favorite",null,{type:e},function(e){console.log(e.favorites)})}function uuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var s=16*Math.random()|0,t="x"==e?s:3&s|8;return t.toString(16)})}function sendCommand(e,s,t,n){if(null==s){var o=document.cookie.split("; ");for(i=0;i<o.length;i++){var c=o[i];if(c.startsWith("PHPSESSID")){s=c.split("=")[1];break}}}var a="";for(var l in t)t.hasOwnProperty(l)&&(a+=l+"="+t[l]+"&");a+="session="+s;var p=new XMLHttpRequest;p.onreadystatechange=function(){4==this.readyState&&200==this.status&&(response=JSON.parse(this.responseText),"success"==response.status&&n(response))},p.open("POST","/api/"+e,!0),p.setRequestHeader("Content-type","application/x-www-form-urlencoded"),p.send(a)}function uploadFile(e,s,t,n,o,c){if(null==s){var a=document.cookie.split("; ");for(i=0;i<a.length;i++){var l=a[i];if(l.startsWith("PHPSESSID")){s=l.split("=")[1];break}}}var p=new FormData;p.append("file",e),p.append("type",t),p.append("parent",n),p.append("library",o),p.append("session",s),$.ajax({type:"POST",url:"/api/create_post",contentType:!1,processData:!1,data:p,success:function(e){e=JSON.parse(e),"success"==e.status&&c(e)}})}function loadPage(e,s){var t=new XMLHttpRequest;t.onreadystatechange=function(){4==this.readyState&&200==this.status&&s(this.responseText)},t.open("GET",e,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.send()}function followAction(){var e=document.getElementById("follow-btn");"follow"!=e.className&&"unfollow"!=e.className||sendCommand(e.className,null,{handle:e.dataset.handle},function(s){s.following?e.className="unfollow":e.className="follow",e.innerHTML="<span>"+s.followers+"</span>"})}function openOptions(e){var s=$("#"+e).offset();$(".l-sett-opt").css({top:s.top+15+"px",opacity:"0",right:"50px",display:""}),$("#imp-bg-fade").css("display",""),setTimeout(function(){var s=document.getElementById(e).dataset.id;document.getElementsByClassName("l-sett-opt")[0].dataset.id=s;var t=["POSTS","REPOSTS","FAVORITES"];t.includes(s)?$(".editable_lib").css({display:"none"}):$(".editable_lib").css({display:""}),$(".l-sett-opt").css({opacity:"",right:""}),$("#imp-bg-fade").css("opacity","")},10)}function closeOptions(){$(".l-sett-opt").css({opacity:"0",right:"50px"}),$("#imp-bg-fade").css("display",""),setTimeout(function(){$(".l-sett-opt").css("display","none")},100)}function deleteLib(){var e=document.getElementsByClassName("l-sett-opt")[0].dataset.id;sendCommand("delete_library",null,{id:e},function(e){"success"==e.status&&location.reload()})}function confirmDeleteLib(){elmt=$("#imp-bg-fade, #imp-message"),elmt.css("display",""),$(".l-sett-opt").css({opacity:"0",right:"50px"}),setTimeout(function(){elmt.css("opacity","")},10)}function openLibSettings(){document.getElementById("libForm").reset();var e=document.getElementsByClassName("l-sett-opt")[0].dataset.id;sendCommand("get_library",null,{id:e},function(e){var s=e,t=s.visibility,i=s.name,n=s.private;closeOptions(),openAddLib(),$("#lib_visibility_"+t).prop("checked",!0),$("#lib_name").val(i),$("#lib_private").prop("checked",1==n),$("#lib_edit_title").html("EDIT LIBRARY"),$(".sendAddLib").html("Save"),editLib=!0})}function openSettings(){closeAccount(),$(".s-settings").css({display:"table"}),$("#imp-bg-fade").css("display",""),setTimeout(function(){$(".l-sett-opt").css({opacity:"",right:""}),$("#imp-bg-fade").css("opacity","")},10)}function fadeToDark(){$("#imp-bg-fade").css("display",""),setTimeout(function(){$(".l-sett-opt").css({opacity:"",right:""}),$("#imp-bg-fade").css("opacity","")},10)}function unfade(){$("#imp-bg-fade").css({opacity:"0"}),setTimeout(function(){$(".l-sett-opt").css({display:"none"})},10)}function closeSettings(){$(".s-settings").css({display:"none"}),$("#imp-bg-fade").css("display","none")}function openTagSearch(){$(".tagFinder").css({display:"block"}),$("#imp-bg-fade").css("display",""),setTimeout(function(){$(".l-sett-opt").css({opacity:"",right:""}),$("#imp-bg-fade").css("opacity","")},10)}function closeTagSearch(){$(".tagFinder").css({display:"none"}),$("#imp-bg-fade").css("display","none")}function openStats(){$(".stats").css({display:"block"}),$("#imp-bg-fade").css("display",""),setTimeout(function(){$(".l-sett-opt").css({opacity:"",right:""}),$("#imp-bg-fade").css("opacity","")},10)}function closeStats(){$(".stats").css({display:"none"}),$("#imp-bg-fade").css("display","none")}function openAddLib(){editLib=!1,document.getElementById("libForm").reset(),$(".addLib").css({display:"block"}),$("#imp-bg-fade").css("display",""),setTimeout(function(){$(".l-sett-opt").css({opacity:"",right:""}),$("#imp-bg-fade").css("opacity","")},10),$("#lib_edit_title").html("ADD LIBRARY"),$(".sendAddLib").html("Add")}function openEditLib(){$(".addLib").css({display:"block"}),$("#imp-bg-fade").css("display",""),setTimeout(function(){$(".l-sett-opt").css({opacity:"",right:""}),$("#imp-bg-fade").css("opacity","")},10)}function closeAddLib(){$(".addLib").css({display:"none"}),$("#imp-bg-fade").css("display","none")}function openAccount(){$(".s-dropdown").css({display:"block"}),$("#imp-bg-fade").css("display",""),setTimeout(function(){$(".l-sett-opt").css({opacity:"",right:""}),$("#imp-bg-fade").css("opacity","")},10),$(".peep").children().css("filter","blur(5px)"),$(".s-dropdown").css("filter","blur(0px)"),$(".peep").css("background","#222")}function closeAccount(){$(".s-dropdown").css({display:"none"}),$("#imp-bg-fade").css("display","none"),$(".peep").children().css("filter","blur(0px)"),$(".peep").css("background","#fff")}function openPost(){window.scrollTo(0,0),$(".m-post").css({display:"block"}),$("#imp-bg-fade").css("display",""),setTimeout(function(){$(".l-sett-opt").css({opacity:"",right:""}),$("#imp-bg-fade").css("opacity","")},10)}function closePost(){$(".m-post").css({display:"none"}),$("#imp-bg-fade").css("display","none")}function openBalance(){$(".balance-message").css({display:"block"}),$("#imp-bg-fade").css("display",""),setTimeout(function(){$(".l-sett-opt").css({opacity:"",right:""}),$("#imp-bg-fade").css("opacity","")},10),$(".peep").children().css("filter","blur(5px)"),$(".balance-message").css("filter","blur(0px)"),$(".peep").css("background","#222")}function closeBalance(){$(".balance-message").css({display:"none"}),$("#imp-bg-fade").css("display","none"),$(".peep").children().css("filter","blur(0px)"),$(".peep").css("background","#fff")}function expandSidenav(){$(".sidenav-home").css({width:"950px"}),$(".home-content").css({width:"auto","margin-left":"950px"}),$(".searchbar").css({display:"none",opacity:"0"}),$(".expand-sidenav").css({transform:"rotate(-30deg)"}),$(".exp-post-corridor").css({display:"inline-block"}),$(".tl-post-title").css({display:"inline-block"}),setTimeout(function(){$(".exp-post-corridor").css({display:"inline-block"}),setTimeout(function(){$(".exp-post-corridor").css({opacity:"1"})},10)},100),setTimeout(function(){$(".tl-post-title").css({display:"inline-block"}),setTimeout(function(){$(".tl-post-title").css({opacity:"1"})},10)},100)}function compactSidenav(){$(".sidenav-home").css({width:"300px"}),$(".home-content").css({width:"auto","margin-left":"300px"}),$(".searchbar").css({display:"block"}),$(".expand-sidenav").css({transform:"rotate(30deg)"}),$(".exp-post-corridor").css({display:"none"}),setTimeout(function(){$(".exp-post-corridor").css({display:"none",opacity:"0"}),$(".tl-post-title").css({display:"none"})},10),$(".tl-post-title").css({opacity:"0"}),setTimeout(function(){$(".searchbar").css({display:"block",opacity:"1"})},100)}function showSidenav(){$(".sidenav-home").css({display:"block"}),$("#imp-bg-fade").css("display",""),setTimeout(function(){$(".sidenav-home").css({left:"0px"}),$("#imp-bg-fade").css("opacity","")},400)}function hideSidenav(){var e=$(window).width();return e>=1200?void showSidenav():($(".sidenav-home").css({left:"-500px"}),$("#imp-bg-fade").css("display","none"),void setTimeout(function(){$(".sidenav-home").css({display:"none"}),$("#imp-bg-fade").css("opacity","0")},400))}function removeDragData(e){e.dataTransfer.items?e.dataTransfer.items.clear():e.dataTransfer.clearData()}function libDrop(e){e.preventDefault();var s=e.dataTransfer.files[0],t=s.name.split(".");uploadFile(s,null,t[t.length-1],-1,e.srcElement.dataset.id,function(e){console.log(e)}),removeDragData(e),$(e.srcElement).removeClass("is-dragover")}function libDrag(e){e.preventDefault(),$(e.srcElement).addClass("is-dragover")}function libDragLeave(e){e.preventDefault(),$(e.srcElement).removeClass("is-dragover")}toggled=new Array,searchCode="";var editLib=!1;$(document).ready(function(){var e=!1,s=!1;for(libs=$(".library"),i=0;i<libs.length;i++)libs[i].id=i.toString();libs.click(function(e){toggled[this.id]?(this.querySelector(".l-settings").style.transform="",this.nextElementSibling.style.height="0px",this.nextElementSibling.style.border="0px"):(this.querySelector(".l-settings").style.transform="rotate(180deg)",content=this.nextElementSibling,content.style.height="",height=content.clientHeight,content.style.height="0px",setTimeout(function(){content.style.height=height.toString()+"px",content.style.margin="0px",content.style.border="2px solid transparent"},10)),toggled[this.id]=!toggled[this.id]}),$(".l-drop").click(function(e){openOptions(this.parentElement.id),e.stopPropagation()}),$(".h-more").click(function(e){openOptions(this.parentElement.id),e.stopPropagation()}),$("#imp-bg-fade").click(function(){$("#imp-message, #imp-bg-fade").css("opacity","0"),setTimeout(function(){$("#imp-message, #imp-bg-fade").css("display","none")},100),closeSettings(),closeTagSearch(),closeStats(),closeAddLib(),closeAccount(),closePost(),closeBalance(),closeOptions(),hideSidenav()}),$(".openSidenav").click(function(){e?hideSidenav():showSidenav(),s=!s}),$(".expand-sidenav").click(function(){e?compactSidenav():expandSidenav(),e=!e}),$(".openSettings").click(function(){openSettings(),$("#imp-bg-fade").css("opacity","")}),$(".closeSettings").click(function(){closeSettings(),$("#imp-message, #imp-bg-fade").css("opacity","0")}),$(".openTagSearch").click(function(){openTagSearch(),tagSearch(""),$("#imp-bg-fade").css("opacity","")}),$(".closeTagSearch").click(function(){closeTagSearch(),$("#imp-message, #imp-bg-fade").css("opacity","0")}),$(".openStats").click(function(){openStats(),$("#imp-bg-fade").css("opacity","")}),$(".closeStats").click(function(){closeStats(),$("#imp-message, #imp-bg-fade").css("opacity","0")}),$(".openAddLib").click(function(){openAddLib(),$("#imp-bg-fade").css("opacity","")}),$(".closeAddLib").click(function(){closeAddLib(),$("#imp-message, #imp-bg-fade").css("opacity","0")}),$(".openAccount").click(function(){openAccount(),$("#imp-bg-fade").css("opacity","")}),$(".closeAccount").click(function(){closeAccount(),$("#imp-message, #imp-bg-fade").css("opacity","0")}),$(".openPost").click(function(){openPost(),$("#imp-bg-fade").css("opacity","")}),$(".closePost").click(function(){closePost(),$("#imp-message, #imp-bg-fade").css("opacity","0")}),$(".openBalance").click(function(){openBalance(),$("#imp-bg-fade").css("opacity","")}),$(".closeBalance").click(function(){closeBalance(),$("#imp-message, #imp-bg-fade").css("opacity","0")}),$(".openEcSearch").click(function(){openBalance(),$("#imp-bg-fade").css("opacity","")}),$(".closeEcSearch").click(function(){closeBalance(),$("#imp-message, #imp-bg-fade").css("opacity","0")}),$(".expand-rec-section").click(function(){expandRec()}),$(".s-tab").click(function(){this.classList.contains("s-selected")||($(".s-tab").toggleClass("s-selected"),$(".s-c-wrapper").toggleClass("s-slide"))}),$(".t-cross").click(function(){var e=this.parentElement;sendCommand("delete_favorite",null,{type:this.dataset.type},function(s){e.parentNode.removeChild(e)})}),$(".c-title-holder .searchbar input").keyup(function(){tagSearch(this.value)}),$(".sendAddLib").click(function(){var e=$("#libForm").serializeArray();console.log(e);for(var s=new Array,t=0;t<e.length;t++)dataP=e[t],s[dataP.name]=dataP.value;if(e=s,editLib){var i=document.getElementsByClassName("l-sett-opt")[0].dataset.id;e.id=i}sendCommand(editLib?"edit_library":"create_library",null,e,function(e){console.log(e),location.reload()})})});